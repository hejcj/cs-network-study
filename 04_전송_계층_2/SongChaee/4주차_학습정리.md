# 4ï¸âƒ£ ì „ì†¡ê³„ì¸µ 2

<br>

## Flow Control

- senderëŠ” receiverì˜ bufferë³´ë‹¤ ë” ë§ì€ ì–‘ì„ ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸
- **speed-matching service** : ë³´ë‚´ëŠ” ì†ë„ì™€ receiverì˜ appì—ì„œ ì²˜ë¦¬í•˜ëŠ” ì†ë„ë¥¼ ë§ì¶”ëŠ” ì„œë¹„ìŠ¤

- receiverì—ì„œ senderë¡œ ì‘ë‹µí•  ë•Œ segmentì˜ headerì— bufferì˜ ë‚¨ì€ í¬ê¸°ë¥¼ ì•Œë ¤ì£¼ëŠ” ì •ë³´(RcvWindow)ë¥¼ ë‹´ì•„ ì „ì†¡

  ``` spare room in buffer = RcvWindow = RcvBuffer - [LastByteRcvd - LastByteRead] ```

â“ reciever bufferì— ë‚¨ì•„ ìˆëŠ” ê³µê°„ì´ ì—†ëŠ” ê²½ìš°?

â€‹	senderëŠ” receiverë¡œë¶€í„° 0ì„ ìˆ˜ì‹ í•˜ê³  ê³„ì† ëŒ€ê¸° ìƒíƒœì¸ ë¬¸ì œ ë°œìƒ

â€‹	ë”°ë¼ì„œ, senderëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì„ì˜ì˜ ê°’ì„ ë³´ë‚´ì„œ ackë¥¼ ìˆ˜ì‹ í•˜ì—¬ ìƒíƒœë¥¼ í™•ì¸

<br>

## Connection Management

### Recall

- TCP senderì™€ receiverëŠ” segmentë¥¼ ì†¡ìˆ˜ì‹ í•˜ê¸° ì „ì— connectionì„ ë¨¼ì € í•´ì•¼í•¨

1. TCP ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”
   - sequence number
   - buffers, flow control info(e.g. RcvWindow)
2. client : connection ì‹œì‘ì 
3. server : clientì— ì˜í•´ì„œ ì—°ê²°ë¨

<br>

### 3 way Handshake

1. **client : serverì—ê²Œ TCP SYN segment ì „ì†¡**
   - data ì—†ìŒ
   - ì´ˆê¸° sequence number ì „ì†¡
2. **server : SYNì„ ìˆ˜ì‹ í•˜ê³  SYNACK segment ì „ì†¡**
   - buffer í• ë‹¹
   - ì„œë²„ì˜ ì´ˆê¸° sequence number ì „ì†¡
3. **client : SYNNACK ìˆ˜ì‹ **
   - ACK segment ì†¡ì‹ 
   - data í¬í•¨ ê°€ëŠ¥

![3-way-handshake](assets/3-way-handshake.png)

<br>

### Closing TCP Connection

1. client : serverì—ê²Œ TCP FIN control segment ì „ì†¡
2. server : FIN ìˆ˜ì‹ , ACK ì‘ë‹µ / FIN ì „ì†¡
3. client : FIN ìˆ˜ì‹ , ACK ì‘ë‹µ
   - **Timed wait** : ACKê°€ í™•ì‹¤íˆ ì „ë‹¬ë˜ë„ë¡ ê¸°ë‹¤ë¦¬ê¸°
4. server : ACK ìˆ˜ì‹ , connection close

<br>

## Principles of congestion control

[congestion controlì˜ 2ê°€ì§€ ì ‘ê·¼ë²•]

1. End-End congestion control
   - networkë¡œë¶€í„° feedbackì—†ìŒ
   - end systemì—ì„œ loss, delayë¥¼ ë³´ê³  í˜¼ì¡ë„ ê²°ì •
   - TCPê°€ ì‚¬ìš©í•˜ëŠ” ì ‘ê·¼ë²•
2. Network-assisted congestion control
   - routerê°€ end systemìœ¼ë¡œ feedback ì „ë‹¬
     - í˜¼ì¡ë„ë¥¼ ê°€ë¥´í‚¤ëŠ” single bit (SNA, DECbit, TCP/IP ECN, ATM)

<br>

## TCP Congestion Control

**[3ë‹¨ê³„]**

1. **Slow Start**

   - TCP connection, ì‹¤ì œ ë³´ë‚´ëŠ” ì–‘ì€ window size(ACK ì—†ì´ í•œë²ˆì— ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì–‘)ê°€ ê²°ì •í•˜ë¯€ë¡œ window sizeëŠ” ì¤‘ìš”í•œ ì—­í• ì„ í•¨

   - ë”°ë¼ì„œ ì´ˆê¸° window sizeëŠ” 1 MSS ë¡œ ì„¤ì • 

   - connection ì‹œì‘ í›„, ì²«ë²ˆì§¸ ìœ ì‹¤ì´ ë°œìƒí•  ë•Œê¹Œì§€ ì „ì†¡ data ì–‘ **exponential ì¦ê°€**

     â†’ ì´ˆê¸° ì†ë„ëŠ” ëŠë¦¬ì§€ë§Œ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì¦ê°€í•¨

2.  **Additive increase**

   - **congestion window sizeê°€ thresholdì— ë„ë‹¬ ì‹œ, data ì–‘ì´ linear ì¦ê°€**

3. **Multiplicative decrease**

   - networkëŠ” ê³µê³µì¬ì´ê¸° ë•Œë¬¸ì—, ê³¼ë¶€í•˜ë¡œ ì´ìƒì´ ìƒê¸°ë©´ ë‹¤ë¥¸ userì—ê²Œë„ ì˜í–¥ì´ ìˆìŒ
   - ë”°ë¼ì„œ step2ì—ì„œ linear í•˜ê²Œ ì¦ê°€í•˜ë‹¤ê°€ step3ì—ì„œ í›… ì¤„ì„

<br>

- senderì˜ ì „ì†¡ ì†ë„

$$
rate = \frac{CongWin}{RTT}[bytes/sec]
$$

â€‹		â†’ RTT (round trip time) : ë°ì´í„° ì†¡ì‹  í›„ ìˆ˜ì‹ ì„ ë°›ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„

â€‹		â†’ CongWin : networkì˜ í˜¼ì¡ë„ì— ë”°ë¼ ê²°ì •ë˜ëŠ” ìš”ì†Œ

- TCPì—ì„œ packet ìœ ì‹¤ íƒì§€ ë°©ë²•? (senderê°€ í˜¼ì¡í•¨ì„ ì¸ì§€í•˜ëŠ” ë°©ë²•)
  1. timeout ë°œìƒ ì‹œ
  2. 3 duplicate ACK ìˆ˜ì‹  ì‹œ

<br>

### ğŸŒŸRefinement 

![graph](assets/graph.png)

ğŸ“Œ **y ì¶• : congestion window size**

ğŸ“Œ **TCP Series 1 Tahoe**

- 80ë…„ëŒ€ ì´ˆ ê°œë°œ

  - transmission round = 1
    - network ìƒí™©ì„ ëª¨ë¥´ê¸° ë•Œë¬¸ì— MSS 1ë¡œ ì‹œì‘ â†’ 2ë°°ì”© ì¦ê°€
  - transmission round = 4
    - Threshold ë„ë‹¬ ì‹œ â†’ 1ì”© ì¦ê°€
  - transmissiont round = 8
    - packet ìœ ì‹¤ íƒì§€
  - transmission round = 9
    - ë‹¤ì‹œ MSS 1 ë¶€í„° ì‹œì‘
    - ì´ë•Œ Treshold ê°’ì€ packet ìœ ì‹¤ ë•Œì˜ window sizeì˜ ì ˆë°˜ì´ ë¨

ğŸ“Œ **TCP Series 2 Reno**

- transmission round = 9
  - Timeout ë°œìƒ ì‹œ : MSS 1ë¶€í„° ì‹œì‘, Threshold ê°’ì€ packet ìœ ì‹¤ ë•Œì˜  window sizeì˜ ì ˆë°˜
  - 3 duplicate ACK ìˆ˜ì‹  ì‹œ : ìƒˆë¡œìš´ Treshold ê°’ë¶€í„° linear í•˜ê²Œ ì¦ê°€

<br>

## TCP Fairness

- Kê°œì˜ TCP session(ë…ë¦½ ìˆ˜í–‰)ì´ BWê°€ Rì¸ ë™ì¼í•œ bottleneck linkë¥¼ ê³µìœ í•˜ê³  ìˆë‹¤ë©´,

  ê°ê°ì˜ sessionì€ R/Kì˜ í‰ê·  ì†ë„ë¥¼ ê°€ì§